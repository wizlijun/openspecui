# Review: 2026-02-14-review-174809

## 第 1 次评审 (2026-02-14 17:48:09)
- P0 `app/src/App.tsx:603` 存在命令注入风险：`content` 只转义了 `"`，放进 shell 双引号后，`$()` / 反引号仍可执行。建议改为不拼接 shell 字符串，或使用严格单引号转义。
- P0 `app/src/reviewPersistenceService.ts:10` 与 `app/tsconfig.app.json:8` 组合会导致 TS 构建报错：仅加载 `vite/client` 类型却使用 `NodeJS.Timeout`。建议改成 `ReturnType<typeof setInterval>`，或显式引入 `node` 类型。
- P0 `app/src/App.tsx:22`、`app/src/reviewPersistenceService.test.ts:1` 在 `noUnusedLocals` 下会报错：`sanitizeKebabName`、`beforeEach`、`afterEach` 未使用。建议删除未使用导入。
- P1 `app/src/reviewPersistenceService.ts:84`、`app/src/reviewPersistenceService.ts:130` 写文件前未确保 `openspec/reviews` 存在；`app/src/useDirectoryPicker.ts:491` 的 `nativeWriteFile` 也不建目录。首次保存很可能失败。建议先创建目录。
- P1 `app/src/App.tsx:594` 与 `app/src/reviewPersistenceService.ts:153` 共用单一 `window.__onCommandCallback`，并发时会互相覆盖回调。建议改为按 `callbackId` 的回调表。
- P1 `app/src/App.tsx:797` 先把 Auto Fix 设为 `fixing`，再发送消息；若发送失败（`app/src/App.tsx:691`），状态不回滚，流程会卡住。建议“发送成功后再推进状态”，失败时回退并提示。
- P2 `app/src/autoFixStateMachine.ts:27` 未接入生产流程（实际逻辑在 `app/src/App.tsx:728`），测试覆盖的是未使用实现。建议统一为单一状态机入口，避免逻辑漂移。

